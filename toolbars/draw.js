// COPYRIGHT Â© 2020 Esri
//
// All rights reserved under the copyright laws of the United States
// and applicable international laws, treaties, and conventions.
//
// This material is licensed for use under the Esri Master License
// Agreement (MLA), and is bound by the terms of that agreement.
// You may redistribute and use this code without modification,
// provided you adhere to the terms of the MLA and include this
// copyright notice.
//
// See use restrictions at http://www.esri.com/legal/pdfs/mla_e204_e300/english
//
// For additional information, contact:
// Environmental Systems Research Institute, Inc.
// Attn: Contracts and Legal Services Department
// 380 New York Street
// Redlands, California, USA 92373
// USA
//
// email: contracts@esri.com
//
// See http://js.arcgis.com/3.33/esri/copyright.txt for details.

define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/Color","dojo/_base/window","dojo/has","dojo/sniff","dojo/keys","dojo/dom-construct","dojo/dom-style","dojo/dom-geometry","../kernel","../sniff","./_toolbar","../symbols/SimpleMarkerSymbol","../symbols/SimpleLineSymbol","../symbols/SimpleFillSymbol","../graphic","../geometry/jsonUtils","../geometry/webMercatorUtils","../geometry/Polyline","../geometry/Polygon","../geometry/Multipoint","../geometry/Rect","dojo/i18n!../nls/jsapi"],(function(e,t,n,o,s,i,a,r,c,h,l,_,p,d,g,y,u,m,M,w,R,E,f,T,O,L){var b=e(g,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(e,n){this.markerSymbol=new y(y.STYLE_SOLID,10,new u(u.STYLE_SOLID,new s([255,0,0]),2),new s([0,0,0,.25])),this.lineSymbol=new u(u.STYLE_SOLID,new s([255,0,0]),2),this.fillSymbol=new m(m.STYLE_SOLID,new u(u.STYLE_SOLID,new s([255,0,0]),2),new s([0,0,0,.25])),this._points=[],this._mouse=!a("esri-touch")&&!a("esri-pointer"),this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15},this._options=t.mixin(t.mixin({},this._defaultOptions),n||{}),(r("ios")||r("android"))&&(this._options.showTooltips=!1),this._onKeyDownHandler=t.hitch(this,this._onKeyDownHandler),this._onMouseDownHandler=t.hitch(this,this._onMouseDownHandler),this._onMouseUpHandler=t.hitch(this,this._onMouseUpHandler),this._onClickHandler=t.hitch(this,this._onClickHandler),this._onMouseMoveHandler=t.hitch(this,this._onMouseMoveHandler),this._onMouseDragHandler=t.hitch(this,this._onMouseDragHandler),this._onDblClickHandler=t.hitch(this,this._onDblClickHandler),this._updateTooltip=t.hitch(this,this._updateTooltip),this._hideTooltip=t.hitch(this,this._hideTooltip),this._redrawGraphic=t.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(e){this.respectDrawingVertexOrder=e},setMarkerSymbol:function(e){this.markerSymbol=e},setLineSymbol:function(e){this.lineSymbol=e},setFillSymbol:function(e){this.fillSymbol=e},activate:function(e,n){this._geometryType&&this.deactivate();var s=this.map,i=o.connect,r=b;switch(this._options=t.mixin(t.mixin({},this._options),n||{}),s.navigationManager.setImmediateClick(!1),e){case r.ARROW:case r.LEFT_ARROW:case r.RIGHT_ARROW:case r.UP_ARROW:case r.DOWN_ARROW:case r.TRIANGLE:case r.CIRCLE:case r.ELLIPSE:case r.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0),this._onClickHandler_connect=i(s,"onClick",this._onClickHandler),this._mouse?(this._onMouseDownHandler_connect=i(s,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=i(s,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=i(s,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=i(s,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=i(s,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=i(s,"onMouseDragEnd",this._onMouseUpHandler)),a("esri-touch")&&(this._onMouseDownHandler2_connect=i(s,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=i(s,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=i(s,"onSwipeEnd",this._onMouseUpHandler));break;case r.POINT:this._onClickHandler_connect=i(s,"onClick",this._onClickHandler);break;case r.LINE:case r.EXTENT:case r.FREEHAND_POLYLINE:case r.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0),this._mouse?(this._onMouseDownHandler_connect=i(s,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=i(s,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=i(s,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=i(s,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=i(s,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=i(s,"onMouseDragEnd",this._onMouseUpHandler)),a("esri-touch")&&(this._onMouseDownHandler2_connect=i(s,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=i(s,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=i(s,"onSwipeEnd",this._onMouseUpHandler));break;case r.POLYLINE:case r.POLYGON:case r.MULTI_POINT:s.navigationManager.setImmediateClick(!0),this._onClickHandler_connect=i(s,"onClick",this._onClickHandler),this._onDblClickHandler_connect=i(s,"onDblClick",this._onDblClickHandler),this._dblClickZoom=s.isDoubleClickZoom,s.disableDoubleClickZoom();break;default:return void console.error("Unsupported geometry type: "+e)}this._onKeyDown_connect=i(s,"onKeyDown",this._onKeyDownHandler),this._redrawConnect=i(s,"onExtentChange",this._redrawGraphic),this._geometryType=e,this._toggleTooltip(!0),s.snappingManager&&"freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType&&(s.snappingManager._startSelectionLayerQuery(),s.snappingManager._setUpSnapping()),this.onActivate(this._geometryType)},deactivate:function(){var e=this.map;this._clear();var t=o.disconnect;switch(t(this._onMouseMoveHandler_connect),t(this._onMouseDownHandler_connect),t(this._onMouseDragHandler_connect),t(this._onMouseUpHandler_connect),t(this._onMouseDownHandler2_connect),t(this._onMouseDragHandler2_connect),t(this._onMouseUpHandler2_connect),t(this._onClickHandler_connect),t(this._onDblClickHandler_connect),t(this._onKeyDown_connect),t(this._redrawConnect),this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null,e.snappingManager&&(e.snappingManager._stopSelectionLayerQuery(),e.snappingManager._killOffSnapping()),this._geometryType){case b.CIRCLE:case b.ELLIPSE:case b.TRIANGLE:case b.ARROW:case b.LEFT_ARROW:case b.RIGHT_ARROW:case b.UP_ARROW:case b.DOWN_ARROW:case b.RECTANGLE:case b.LINE:case b.EXTENT:case b.FREEHAND_POLYLINE:case b.FREEHAND_POLYGON:this._activateMapTools(!0,!1,!1,!0);break;case b.POLYLINE:case b.POLYGON:case b.MULTI_POINT:this._dblClickZoom&&e.enableDoubleClickZoom()}var n=this._geometryType;this._geometryType=null,e.navigationManager.setImmediateClick(!1),this._toggleTooltip(!1),this.onDeactivate(n)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0),this._graphic=null,this.map.snappingManager&&this.map.snappingManager._setGraphic(null),this._points=[]},finishDrawing:function(){var e,t=this._points,s=this.map.spatialReference,i=b;switch(t=t.slice(0,t.length),this._geometryType){case i.POLYLINE:if(!this._graphic||t.length<2)return;(e=new E(s)).addPath([].concat(t));break;case i.POLYGON:if(!this._graphic||t.length<3)return;e=new f(s);var a=[].concat(t,[t[0].offset(0,0)]);f.prototype.isClockwise(a)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse()),e.addRing(a);break;case i.MULTI_POINT:e=new T(s),n.forEach(t,(function(t){e.addPoint(t)}))}o.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0),this._drawEnd(e)},_drawEnd:function(e){if(e){var t,n=this.map.spatialReference;this.onDrawEnd(e),n&&(n.isWebMercator()?t=R.webMercatorToGeographic(e,!0):4326===n.wkid&&(t=w.fromJson(e.toJson()))),this.onDrawComplete({geometry:e,geographicGeometry:t})}},_normalizeRect:function(e,t,n){var o=e.x,s=e.y,i=t.x,a=t.y,r=Math.abs(o-i),c=Math.abs(s-a);return{x:Math.min(o,i),y:Math.max(s,a),width:r,height:c,spatialReference:n}},_onMouseDownHandler:function(e){var t;this._dragged=!1,this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);var n=t||e.mapPoint,o=b,s=this.map,i=s.spatialReference;switch(this._points.push(n.offset(0,0)),this._geometryType){case o.LINE:this._graphic=s.graphics.add(new M(new E({paths:[[[n.x,n.y],[n.x,n.y]]],spatialReference:i}),this.lineSymbol),!0),s.snappingManager&&s.snappingManager._setGraphic(this._graphic);break;case o.EXTENT:break;case o.FREEHAND_POLYLINE:this._oldPoint=e.screenPoint;var r=new E(i);r.addPath(this._points),this._graphic=s.graphics.add(new M(r,this.lineSymbol),!0),s.snappingManager&&s.snappingManager._setGraphic(this._graphic);break;case o.CIRCLE:case o.ELLIPSE:case o.TRIANGLE:case o.ARROW:case o.LEFT_ARROW:case o.RIGHT_ARROW:case o.UP_ARROW:case o.DOWN_ARROW:case o.RECTANGLE:case o.FREEHAND_POLYGON:this._oldPoint=e.screenPoint;var c=new f(i);c.addRing(this._points),this._graphic=s.graphics.add(new M(c,this.fillSymbol),!0),s.snappingManager&&s.snappingManager._setGraphic(this._graphic)}a("esri-touch")&&e.preventDefault(),1===this._points.length&&this.onDrawStart()},_onMouseMoveHandler:function(e){var t;this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);var n=t||e.mapPoint,o=this._graphic.geometry;switch(this._geometryType){case b.POLYLINE:case b.POLYGON:var s=this._points.length,i=!!o.getPoint(0,s);n=n.offset(0,0),i?o.setPoint(0,s,n):o.insertPoint(0,s,n),this._graphic.setGeometry(o)}},_onMouseDragHandler:function(e){if(this._graphic||this._points.length)if(!a("esri-touch")||this._points.length){var n;this._dragged=!0,this.map.snappingManager&&(n=this.map.snappingManager._snappingPoint);var o=this._points[0],s=n||e.mapPoint,i=this.map,r=i.spatialReference,c=this._graphic,h=b,l=i.toScreen(o),_=i.toScreen(s),p=[],d=_.x-l.x,g=_.y-l.y,y=Math.sqrt(d*d+g*g);switch(this._geometryType){case h.CIRCLE:this._hideTooltip(),c.geometry=f.createCircle({center:l,r:y,numberOfPoints:60,map:i}),c.setGeometry(c.geometry);break;case h.ELLIPSE:this._hideTooltip(),c.geometry=f.createEllipse({center:l,longAxis:d,shortAxis:g,numberOfPoints:60,map:i}),c.setGeometry(c.geometry);break;case h.TRIANGLE:this._hideTooltip(),p=[[0,-y],[.8660254037844386*y,.5*y],[-.8660254037844386*y,.5*y],[0,-y]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.ARROW:this._hideTooltip();var u=g/y,m=d/y,w=.25*m*y,R=.25*y/(g/d),E=.25*u*y;p=[[d,g],[d-w*(1+24/R),g+24*m-E],[d-w*(1+12/R),g+12*m-E],[-12*u,12*m],[12*u,-12*m],[d-w*(1-12/R),g-12*m-E],[d-w*(1-24/R),g-24*m-E],[d,g]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.LEFT_ARROW:this._hideTooltip(),p=d<=0?[[d,0],[.75*d,g],[.75*d,.5*g],[0,.5*g],[0,-.5*g],[.75*d,-.5*g],[.75*d,-g],[d,0]]:[[0,0],[.25*d,g],[.25*d,.5*g],[d,.5*g],[d,-.5*g],[.25*d,-.5*g],[.25*d,-g],[0,0]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.RIGHT_ARROW:this._hideTooltip(),p=d>=0?[[d,0],[.75*d,g],[.75*d,.5*g],[0,.5*g],[0,-.5*g],[.75*d,-.5*g],[.75*d,-g],[d,0]]:[[0,0],[.25*d,g],[.25*d,.5*g],[d,.5*g],[d,-.5*g],[.25*d,-.5*g],[.25*d,-g],[0,0]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.UP_ARROW:this._hideTooltip(),p=g<=0?[[0,g],[-d,.75*g],[-.5*d,.75*g],[-.5*d,0],[.5*d,0],[.5*d,.75*g],[d,.75*g],[0,g]]:[[0,0],[-d,.25*g],[-.5*d,.25*g],[-.5*d,g],[.5*d,g],[.5*d,.25*g],[d,.25*g],[0,0]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.DOWN_ARROW:this._hideTooltip(),p=g>=0?[[0,g],[-d,.75*g],[-.5*d,.75*g],[-.5*d,0],[.5*d,0],[.5*d,.75*g],[d,.75*g],[0,g]]:[[0,0],[-d,.25*g],[-.5*d,.25*g],[-.5*d,g],[.5*d,g],[.5*d,.25*g],[d,.25*g],[0,0]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.RECTANGLE:this._hideTooltip(),p=[[0,0],[d,0],[d,g],[0,g],[0,0]],c.geometry=this._toPolygon(p,l.x,l.y),c.setGeometry(c.geometry);break;case h.LINE:c.setGeometry(t.mixin(c.geometry,{paths:[[[o.x,o.y],[s.x,s.y]]]}));break;case h.EXTENT:c&&i.graphics.remove(c,!0);var T=new O(this._normalizeRect(o,s,r));T._originOnly=!0,this._graphic=i.graphics.add(new M(T,this.fillSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic);break;case h.FREEHAND_POLYLINE:case h.FREEHAND_POLYGON:if(this._hideTooltip(),!1===this._canDrawFreehandPoint(e))return void(a("esri-touch")&&e.preventDefault());this._points.push(e.mapPoint.offset(0,0)),c.geometry._insertPoints([s.offset(0,0)],0),c.setGeometry(c.geometry)}a("esri-touch")&&e.preventDefault()}else e.preventDefault()},_canDrawFreehandPoint:function(e){if(!this._oldPoint)return!1;var t=this._oldPoint.x-e.screenPoint.x;t=t<0?-1*t:t;var n=this._oldPoint.y-e.screenPoint.y;n=n<0?-1*n:n;var o=this._options.tolerance;if(t<o&&n<o)return!1;var s=new Date;return!(s-this._startTime<this._options.drawTime)&&(this._startTime=s,this._oldPoint=e.screenPoint,!0)},_onMouseUpHandler:function(e){if(this._dragged&&this._graphic){var t;0===this._points.length&&this._points.push(e.mapPoint.offset(0,0)),this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);var n,o=this._points[0],s=t||e.mapPoint,i=this.map.spatialReference,r=b;switch(this._geometryType){case r.CIRCLE:case r.ELLIPSE:case r.TRIANGLE:case r.ARROW:case r.LEFT_ARROW:case r.RIGHT_ARROW:case r.UP_ARROW:case r.DOWN_ARROW:case r.RECTANGLE:n=this._graphic.geometry;break;case r.LINE:n=new E({paths:[[[o.x,o.y],[s.x,s.y]]],spatialReference:i});break;case r.EXTENT:n=new O(this._normalizeRect(o,s,i)).getExtent();break;case r.FREEHAND_POLYLINE:(n=new E(i)).addPath([].concat(this._points,[s.offset(0,0)]));break;case r.FREEHAND_POLYGON:n=new f(i);var c=[].concat(this._points,[s.offset(0,0),this._points[0].offset(0,0)]);f.prototype.isClockwise(c)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),c.reverse()),n.addRing(c)}a("esri-touch")&&e.preventDefault(),this._clear(),this._drawEnd(n)}else this._clear()},_onClickHandler:function(e){var t;this.map.snappingManager&&(t=this.map.snappingManager._snappingPoint);var n,s=t||e.mapPoint,i=this.map,a=i.toScreen(s),r=b;switch(this._points.push(s.offset(0,0)),this._geometryType){case r.POINT:this.onDrawStart(),this._drawEnd(s.offset(0,0)),this._setTooltipMessage(0);break;case r.POLYLINE:if(1===this._points.length){var c=new E(i.spatialReference);c.addPath(this._points),this._graphic=i.graphics.add(new M(c,this.lineSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=o.connect(i,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()}else this._graphic.geometry._insertPoints([s.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol);break;case r.POLYGON:1===this._points.length?((n=new f(i.spatialReference)).addRing(this._points),this._graphic=i.graphics.add(new M(n,this.fillSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=o.connect(i,"onMouseMove",this._onMouseMoveHandler),this.onDrawStart()):(this._graphic.geometry._insertPoints([s.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol));break;case r.MULTI_POINT:var h=this._points;if(1===h.length){var l=new T(i.spatialReference);l.addPoint(h[h.length-1]),this._graphic=i.graphics.add(new M(l,this.markerSymbol),!0),i.snappingManager&&i.snappingManager._setGraphic(this._graphic),this.onDrawStart()}else this._graphic.geometry.addPoint(h[h.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol);break;case r.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],a.x,a.y);break;case r.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],a.x,a.y);break;case r.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],a.x,a.y);break;case r.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],a.x,a.y);break;case r.DOWN_ARROW:this._addShape([[0,0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],a.x,a.y);break;case r.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],a.x,a.y);break;case r.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],a.x-48,a.y+48);break;case r.CIRCLE:this._clear(),this.onDrawStart(),this._drawEnd(f.createCircle({center:a,r:48,numberOfPoints:60,map:i}));break;case r.ELLIPSE:this._clear(),this.onDrawStart(),this._drawEnd(f.createEllipse({center:a,longAxis:48,shortAxis:24,numberOfPoints:60,map:i}))}this._setTooltipMessage(this._points.length)},_addShape:function(e,t,n){this._setTooltipMessage(0),this._clear(),this.onDrawStart(),this._drawEnd(this._toPolygon(e,t,n))},_toPolygon:function(e,t,o){var s=this.map,i=new f(s.spatialReference);return i.addRing(n.map(e,(function(e){return s.toMap({x:e[0]+t,y:e[1]+o})}))),i},_onDblClickHandler:function(e){var t,s=this._points,i=this.map.spatialReference,r=b;a("esri-touch")&&s.push(e.mapPoint);var c=s[s.length-1],h=s[s.length-2];switch(s=c&&h&&c.x===h.x&&c.y===h.y?s.slice(0,s.length-1):s.slice(0,s.length),this._geometryType){case r.POLYLINE:if(!this._graphic||s.length<2)return o.disconnect(this._onMouseMoveHandler_connect),this._clear(),void this._onClickHandler(e);(t=new E(i)).addPath([].concat(s));break;case r.POLYGON:if(!this._graphic||s.length<2)return o.disconnect(this._onMouseMoveHandler_connect),this._clear(),void this._onClickHandler(e);t=new f(i);var l=[].concat(s,[s[0].offset(0,0)]);f.prototype.isClockwise(l)||this.respectDrawingVertexOrder||(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),l.reverse()),t.addRing(l);break;case r.MULTI_POINT:t=new T(i),n.forEach(s,(function(e){t.addPoint(e)}))}o.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0),this._drawEnd(t)},_onKeyDownHandler:function(e){e.keyCode===c.ESCAPE&&(o.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(e){if(this._options.showTooltips)if(e){if(this._tooltip)return;var t=this.map.container;this._tooltip=h.create("div",{class:"esriMapTooltip"},t),_.isBodyLtr()||l.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=o.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=o.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=o.connect(this.map,"onMouseMove",this._updateTooltip)}else this._tooltip&&(o.disconnect(this._onTooltipMouseEnterHandler_connect),o.disconnect(this._onTooltipMouseLeaveHandler_connect),o.disconnect(this._onTooltipMouseMoveHandler_connect),h.destroy(this._tooltip),this._tooltip=null)},_hideTooltip:function(){var e=this._tooltip;e&&(e.style.display="none")},_setTooltipMessage:function(e){var t=this._tooltip;if(t){var n=e,o="";switch(this._geometryType){case b.POINT:o=L.toolbars.draw.addPoint;break;case b.ARROW:case b.LEFT_ARROW:case b.RIGHT_ARROW:case b.UP_ARROW:case b.DOWN_ARROW:case b.TRIANGLE:case b.RECTANGLE:case b.CIRCLE:case b.ELLIPSE:o=L.toolbars.draw.addShape;break;case b.LINE:case b.EXTENT:case b.FREEHAND_POLYLINE:case b.FREEHAND_POLYGON:o=L.toolbars.draw.freehand;break;case b.POLYLINE:case b.POLYGON:o=L.toolbars.draw.start,1===n?o=L.toolbars.draw.resume:n>=2&&(o=L.toolbars.draw.complete);break;case b.MULTI_POINT:o=L.toolbars.draw.addMultipoint,n>=1&&(o=L.toolbars.draw.finish)}t.innerHTML=o}},_updateTooltip:function(e){var t,n,o=this._tooltip;o&&(e.clientX||e.pageY?(t=e.clientX,n=e.clientY):(t=e.clientX+i.body().scrollLeft-i.body().clientLeft,n=e.clientY+i.body().scrollTop-i.body().clientTop),o.style.display="none",l.set(o,{left:t+this._options.tooltipOffset+"px",top:n+"px"}),o.style.display="")},_redrawGraphic:function(e,t,n,o){if(n||this.map.wrapAround180){var s=this._graphic;s&&s.setGeometry(s.geometry)}},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawStart:function(){},onDrawEnd:function(){}});return t.mixin(b,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"}),a("extend-esri")&&t.setObject("toolbars.Draw",b,p),b}));
